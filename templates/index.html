<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content ="width=device-width, initial-scale=1.0">
  <title>WILL.ia</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}?v=7">
<head>
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=GTM-W2CG2SS5"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'GTM-W2CG2SS5');
  </script>
</head>

</head>
<body>

<a href="https://wills-journey.webflow.io/" class="logo">
  <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo Will.ia">
</a>

<div class="logos-bottom">
  <a href="https://www.linkedin.com/in/willdorignac/" target="_blank">
    <img src="{{ url_for('static', filename='logo1.png') }}" alt="Logo 1">
  </a>
  <a href="https://www.instagram.com/will_dorignac/" target="_blank">
    <img src="{{ url_for('static', filename='logo2.png') }}" alt="Logo 2">
  </a>
  <a href="{{ url_for('static', filename='CV Will Dorignac.pdf') }}" download>
    <img src="{{ url_for('static', filename='cv.png') }}" alt="T√©l√©charger mon CV">
  </a>
</div>

  <div class="container">
    <h2>WILL.ia</h2>
    <p>BONJOUR. JE SUIS PROGRAMM√â POUR TE PROPOSER DES ACTIVATIONS MARKETING & COMMUNICATION</p>

    <form id="agent-form">
      <textarea id="prompt" name="prompt" placeholder="DONNE MOI DES D√âTAILS : marque, budget, p√©riode,..."></textarea>
      <button type="submit">Activer WILL.ia ü§ñ‚Äã</button>
    </form>

<div id="output" style="display:none;"></div>

<!-- Loader Will.ia -->
<div id="loader" style="display:none; text-align:center; margin-top:20px;">
  <div class="hourglass"></div>
  <p>G√©n√©ration en cours. Encore quelques instants...</p>
</div>

<button id="download-btn" style="display:none;">üìÑ T√©l√©charger en PDF </button>

<script>
document.getElementById("agent-form").addEventListener("submit", async function(e) {
  e.preventDefault();
  const prompt = document.getElementById("prompt").value.trim();

  if (!prompt) {
    document.getElementById("output").style.display = "block";
    document.getElementById("output").innerText = "Tu ne m'as donn√© aucune indication üòÖ";
    return;
  }

  // Affiche le loader + masque le texte pr√©c√©dent
  document.getElementById("loader").style.display = "block";
  document.getElementById("output").style.display = "none";

  try {
    const response = await fetch("/generate", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ prompt })
    });

    const data = await response.json();

    // Cache le loader et affiche le r√©sultat
    document.getElementById("loader").style.display = "none";
    document.getElementById("output").style.display = "block";

    if (data.propositions) {
      document.getElementById("output").innerText = data.propositions;
      document.getElementById("download-btn").style.display = "block";
    } else {
      document.getElementById("output").innerText = "‚ùå Erreur : " + (data.error || "R√©ponse vide");
    }

  } catch (err) {
    console.error("Erreur JS :", err);
    document.getElementById("loader").style.display = "none";
    document.getElementById("output").style.display = "block";
    document.getElementById("output").innerText = "‚ö†Ô∏è Impossible de contacter le serveur.";
  }
});

    // Bouton PDF
    document.getElementById("download-btn").addEventListener("click", async function() {
      const content = document.getElementById("output").innerText;

      const response = await fetch("/download_pdf", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ content })
      });

      const blob = await response.blob();
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "Propositions_WillIA.pdf";
      document.body.appendChild(a);
      a.click();
      a.remove();
    });

  </script>
</body>
</html>